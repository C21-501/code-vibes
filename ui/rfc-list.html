<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ RFC - RFC Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: relative;
        }

        .logo {
            padding: 0 20px 30px;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .nav-menu {
            list-style: none;
            padding-bottom: 80px; /* Space for logout button */
        }

        .nav-item {
            margin: 5px 0;
        }

        .nav-link {
            display: block;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.05);
            color: white;
            border-left-color: #3498db;
        }

        .nav-link.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: #3498db;
        }

        /* Logout button */
        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .btn-logout {
            width: 100%;
            padding: 12px;
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-logout:hover {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            color: #2c3e50;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* User info */
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: #6c757d;
        }

        .role-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .role-requester {
            background: #e3f2fd;
            color: #1976d2;
        }

        .role-executor {
            background: #fff3e0;
            color: #f57c00;
        }

        .role-cab-manager {
            background: #e8f5e9;
            color: #388e3c;
        }

        .role-admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-view {
            padding: 6px 12px;
            background: white;
            color: #3498db;
            border: 1px solid #3498db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-view:hover {
            background: #3498db;
            color: white;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        .btn-edit {
            padding: 6px 12px;
            background: white;
            color: #f39c12;
            border: 1px solid #f39c12;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-edit:hover {
            background: #f39c12;
            color: white;
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
        }

        .btn-edit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f5f5f5;
            color: #999;
            border-color: #ddd;
        }

        .btn-edit:disabled:hover {
            background: #f5f5f5;
            color: #999;
            box-shadow: none;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: 13px;
            font-weight: 500;
            color: #555;
            margin-bottom: 5px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        /* My RFC Filter Checkbox */
        .my-rfc-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }

        .my-rfc-filter:hover {
            background: #e9ecef;
        }

        .filter-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #3498db;
        }

        .checkbox-label {
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            user-select: none;
            margin: 0;
        }

        .my-rfc-filter input[type="checkbox"]:checked ~ .checkbox-label {
            color: #3498db;
        }

        /* RFC Table */
        .rfc-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .rfc-table {
            width: 100%;
            border-collapse: collapse;
        }

        .rfc-table thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .rfc-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rfc-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        .rfc-table tbody tr {
            transition: background 0.2s ease;
            cursor: pointer;
        }

        .rfc-table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-new {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-under-review {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-approved {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status-implemented {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .status-rejected {
            background: #ffebee;
            color: #c62828;
        }

        /* Urgency badges */
        .urgency-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .urgency-emergency {
            background: #ffebee;
            color: #c62828;
        }

        .urgency-urgent {
            background: #fff3e0;
            color: #f57c00;
        }

        .urgency-planned {
            background: #e3f2fd;
            color: #1976d2;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .pagination-info {
            color: #6c757d;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 10px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f8f9fa;
            border-color: #3498db;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .pagination-dots {
            padding: 0 8px;
            color: #6c757d;
            display: flex;
            align-items: center;
        }

        /* RFC ID link */
        .rfc-id-link {
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
        }

        .rfc-id-link:hover {
            text-decoration: underline;
        }

        /* Subsystems list */
        .subsystems-list {
            font-size: 12px;
            color: #6c757d;
        }

        .system-group {
            margin-bottom: 5px;
        }

        .system-group:last-child {
            margin-bottom: 0;
        }

        .system-group strong {
            display: block;
            color: #495057;
            font-size: 11px;
            margin-bottom: 3px;
        }

        .subsystem-item {
            display: inline-block;
            margin-right: 5px;
            margin-bottom: 3px;
            padding: 2px 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 11px;
        }

        /* Attachment badge */
        .attachment-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 13px;
            color: #495057;
            border: 1px solid #e9ecef;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h2 {
            font-size: 22px;
            color: #2c3e50;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #6c757d;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #e9ecef;
            color: #495057;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-radius: 0 0 12px 12px;
        }

        .btn-danger {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: #c0392b;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .btn-danger:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            padding: 10px 20px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .modal-section {
            margin-bottom: 24px;
        }

        .modal-section:last-child {
            margin-bottom: 0;
        }

        .modal-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .modal-field {
            margin-bottom: 16px;
        }

        .modal-field-label {
            font-size: 12px;
            font-weight: 500;
            color: #6c757d;
            margin-bottom: 4px;
        }

        .modal-field-value {
            font-size: 14px;
            color: #2c3e50;
        }

        .modal-description {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            font-size: 14px;
            line-height: 1.6;
            color: #495057;
        }

        .affected-system-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
        }

        .affected-system-card:last-child {
            margin-bottom: 0;
        }

        .system-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .subsystem-card {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid #dee2e6;
        }

        .subsystem-card:last-child {
            margin-bottom: 0;
        }

        .subsystem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .subsystem-name {
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }

        .subsystem-info {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #6c757d;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e9ecef;
        }

        .attachment-item:last-child {
            margin-bottom: 0;
        }

        .attachment-icon {
            font-size: 24px;
        }

        .attachment-details {
            flex: 1;
        }

        .attachment-name {
            font-weight: 500;
            color: #2c3e50;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .attachment-meta {
            font-size: 12px;
            color: #6c757d;
        }

        .confirmation-badge,
        .execution-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .confirmation-pending,
        .execution-pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .confirmation-confirmed,
        .execution-in-progress {
            background: #e3f2fd;
            color: #1976d2;
        }

        .confirmation-rejected {
            background: #ffebee;
            color: #c62828;
        }

        .execution-done {
            background: #e8f5e9;
            color: #388e3c;
        }

        /* Create RFC Modal */
        .modal-overlay.create-rfc-modal .modal {
            max-width: 1000px;
            width: 95%;
            max-height: 95vh;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }

        .form-group label .required {
            color: #e74c3c;
            margin-left: 4px;
        }

        .form-group input[type="text"],
        .form-group input[type="datetime-local"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group .field-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
        }

        .form-group .field-counter {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
            text-align: right;
        }

        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: #e74c3c;
        }

        .form-group .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .form-group.error .error-message {
            display: block;
        }

        /* Affected Systems */
        .affected-systems-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .affected-system-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            position: relative;
        }

        .system-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .system-select-group {
            flex: 1;
        }

        .system-select-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #495057;
            margin-bottom: 6px;
        }

        .system-select-group select {
            width: 100%;
            padding: 9px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            background: white;
        }

        /* Autocomplete for system selection */
        .autocomplete-container {
            position: relative;
            width: 100%;
        }

        .autocomplete-input {
            width: 100%;
            padding: 9px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .autocomplete-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .autocomplete-dropdown.show {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s ease;
        }

        .autocomplete-item:hover {
            background: #f8f9fa;
        }

        .autocomplete-item.selected {
            background: #e3f2fd;
            color: #1976d2;
        }

        .autocomplete-loading {
            padding: 10px 12px;
            text-align: center;
            color: #6c757d;
            font-size: 12px;
        }

        .autocomplete-no-results {
            padding: 10px 12px;
            text-align: center;
            color: #6c757d;
            font-size: 12px;
        }

        .btn-remove-system {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #fff;
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-remove-system:hover {
            background: #e74c3c;
            color: white;
        }

        /* Subsystems */
        .subsystems-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .subsystem-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            position: relative;
        }

        .subsystem-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .subsystem-field {
            display: flex;
            flex-direction: column;
        }

        .subsystem-field label {
            font-size: 12px;
            font-weight: 500;
            color: #495057;
            margin-bottom: 6px;
        }

        .subsystem-field select {
            padding: 9px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            background: white;
        }

        .btn-remove-subsystem {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 18px;
            padding: 4px 8px;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .btn-remove-subsystem:hover {
            color: #c0392b;
            background: #ffebee;
            border-radius: 4px;
        }

        .btn-add {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: white;
            color: #3498db;
            border: 1px solid #3498db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            background: #3498db;
            color: white;
        }

        .btn-add-subsystem {
            margin-top: 10px;
        }

        .btn-add-system {
            width: 100%;
            padding: 10px;
            margin-top: 12px;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            margin-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .form-actions .btn {
            padding: 10px 20px;
        }

        .btn-primary:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 16px 20px;
            min-width: 300px;
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-left: 4px solid #27ae60;
        }

        .toast.error {
            border-left: 4px solid #e74c3c;
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 13px;
            color: #6c757d;
        }

        .toast-close {
            background: none;
            border: none;
            color: #95a5a6;
            cursor: pointer;
            font-size: 20px;
            padding: 0;
            line-height: 1;
        }

        .toast-close:hover {
            color: #7f8c8d;
        }

        /* Delete Confirmation Modal */
        .delete-confirm-modal .modal {
            max-width: 500px;
        }

        .delete-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
        }

        .delete-warning strong {
            display: block;
            margin-bottom: 8px;
            color: #856404;
            font-size: 15px;
        }

        .delete-confirm-input {
            margin-top: 20px;
        }

        .delete-confirm-input label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }

        .delete-confirm-input input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .delete-confirm-input input:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .delete-confirm-input .field-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
        }

        .delete-rfc-info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            border: 1px solid #e9ecef;
        }

        .delete-rfc-info-label {
            font-size: 11px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .delete-rfc-info-value {
            font-size: 15px;
            font-weight: 600;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .rfc-table {
                font-size: 12px;
            }

            .rfc-table th,
            .rfc-table td {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .header-right {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }

            .user-info {
                width: 100%;
            }

            .header .btn-primary {
                width: 100%;
            }

            .subsystem-fields {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column-reverse;
            }

            .form-actions .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">RFC System</div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="rfc-list.html" class="nav-link active">üìã –°–ø–∏—Å–æ–∫ RFC</a>
                    </li>
                    <li class="nav-item">
                        <a href="reference-team.html" class="nav-link">üë• –ö–æ–º–∞–Ω–¥—ã</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">üñ•Ô∏è –°–∏—Å—Ç–µ–º—ã</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">üîß –ü–æ–¥—Å–∏—Å—Ç–µ–º—ã</a>
                    </li>
                    <li class="nav-item">
                        <a href="reference-user.html" class="nav-link">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button class="btn-logout" id="logout-btn">
                    <span>üö™</span>
                    <span>–í—ã–π—Ç–∏</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1>–°–ø–∏—Å–æ–∫ RFC</h1>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">–ò–ò</div>
                        <div class="user-details">
                            <div class="user-name" id="user-name">–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω</div>
                            <div class="user-role">
                                <span class="role-badge role-admin" id="user-role-badge">Admin</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="create-rfc-btn">+ –°–æ–∑–¥–∞—Ç—å RFC</button>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="status-filter">–°—Ç–∞—Ç—É—Å</label>
                        <select id="status-filter">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="NEW">–ù–æ–≤—ã–π</option>
                            <option value="UNDER_REVIEW">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                            <option value="APPROVED">–û–¥–æ–±—Ä–µ–Ω</option>
                            <option value="IMPLEMENTED">–í–Ω–µ–¥—Ä–µ–Ω</option>
                            <option value="REJECTED">–û—Ç–∫–ª–æ–Ω–µ–Ω</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="urgency-filter">–°—Ä–æ—á–Ω–æ—Å—Ç—å</label>
                        <select id="urgency-filter">
                            <option value="">–í—Å–µ</option>
                            <option value="EMERGENCY">–ë–µ–∑–æ—Ç–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ</option>
                            <option value="URGENT">–°—Ä–æ—á–Ω–æ–µ</option>
                            <option value="PLANNED">–ü–ª–∞–Ω–æ–≤–æ–µ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="requester-filter">ID —Å–æ–∑–¥–∞—Ç–µ–ª—è</label>
                        <input type="number" id="requester-filter" placeholder="–í–≤–µ–¥–∏—Ç–µ ID">
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <div class="my-rfc-filter">
                            <input type="checkbox" id="my-rfc-filter" class="filter-checkbox">
                            <label for="my-rfc-filter" class="checkbox-label">–¢–æ–ª—å–∫–æ –º–æ–∏ RFC</label>
                        </div>
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-primary" style="width: 100%;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    </div>
                </div>
            </div>

            <!-- RFC Table -->
            <div class="rfc-table-container">
                <table class="rfc-table">
                    <thead>
                        <tr>
                            <th style="width: 80px;">ID</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th style="width: 140px;">–°—Ç–∞—Ç—É—Å</th>
                            <th style="width: 130px;">–°—Ä–æ—á–Ω–æ—Å—Ç—å</th>
                            <th style="width: 150px;">–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                            <th style="width: 120px;">–°–æ–∑–¥–∞—Ç–µ–ª—å</th>
                            <th style="width: 150px;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            <th style="width: 150px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample RFC 1 - Created by current user (Ivanov) -->
                        <tr data-rfc-id="1">
                            <td><a href="#" class="rfc-id-link">RFC-001</a></td>
                            <td>
                                <div style="font-weight: 500; margin-bottom: 4px;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    <span title="–°–∏—Å—Ç–µ–º—ã">üñ•Ô∏è 1</span> ¬∑ 
                                    <span title="–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã">üì¶ 2</span> ¬∑ 
                                    <span title="–í–ª–æ–∂–µ–Ω–∏—è">üìé 2</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-new">–ù–æ–≤—ã–π</span></td>
                            <td><span class="urgency-badge urgency-planned">–ü–ª–∞–Ω–æ–≤–æ–µ</span></td>
                            <td>2025-11-10 14:00</td>
                            <td>–ò–≤–∞–Ω–æ–≤ –ò.</td>
                            <td>2025-11-03 10:30</td>
                            <td>
                                <div class="action-buttons">
                                <button class="btn-view" onclick="openRfcModal(1)">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    <button class="btn-edit" onclick="openEditRfcModal(1)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </td>
                        </tr>

                        <!-- Sample RFC 2 -->
                        <tr data-rfc-id="2">
                            <td><a href="#" class="rfc-id-link">RFC-002</a></td>
                            <td>
                                <div style="font-weight: 500; margin-bottom: 4px;">–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏</div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    <span title="–°–∏—Å—Ç–µ–º—ã">üñ•Ô∏è 1</span> ¬∑ 
                                    <span title="–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã">üì¶ 2</span> ¬∑ 
                                    <span title="–í–ª–æ–∂–µ–Ω–∏—è">üìé 1</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-under-review">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</span></td>
                            <td><span class="urgency-badge urgency-emergency">–ë–µ–∑–æ—Ç–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ</span></td>
                            <td>2025-11-04 09:00</td>
                            <td>–ü–µ—Ç—Ä–æ–≤ –ü.</td>
                            <td>2025-11-03 08:15</td>
                            <td>
                                <div class="action-buttons">
                                <button class="btn-view" onclick="openRfcModal(2)">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    <button class="btn-edit" onclick="openEditRfcModal(2)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </td>
                        </tr>

                        <!-- Sample RFC 3 -->
                        <tr data-rfc-id="3">
                            <td><a href="#" class="rfc-id-link">RFC-003</a></td>
                            <td>
                                <div style="font-weight: 500; margin-bottom: 4px;">–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞</div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    <span title="–°–∏—Å—Ç–µ–º—ã">üñ•Ô∏è 1</span> ¬∑ 
                                    <span title="–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã">üì¶ 3</span> ¬∑ 
                                    <span title="–í–ª–æ–∂–µ–Ω–∏—è">üìé 5</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-approved">–û–¥–æ–±—Ä–µ–Ω</span></td>
                            <td><span class="urgency-badge urgency-urgent">–°—Ä–æ—á–Ω–æ–µ</span></td>
                            <td>2025-11-15 16:00</td>
                            <td>–°–∏–¥–æ—Ä–æ–≤–∞ –°.</td>
                            <td>2025-11-02 14:20</td>
                            <td>
                                <div class="action-buttons">
                                <button class="btn-view" onclick="openRfcModal(3)">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    <button class="btn-edit" onclick="openEditRfcModal(3)" disabled title="RFC —É–∂–µ –æ–¥–æ–±—Ä–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </td>
                        </tr>

                        <!-- Sample RFC 4 -->
                        <tr data-rfc-id="4">
                            <td><a href="#" class="rfc-id-link">RFC-004</a></td>
                            <td>
                                <div style="font-weight: 500; margin-bottom: 4px;">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    <span title="–°–∏—Å—Ç–µ–º—ã">üñ•Ô∏è 1</span> ¬∑ 
                                    <span title="–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã">üì¶ 1</span> ¬∑ 
                                    <span title="–í–ª–æ–∂–µ–Ω–∏—è" style="opacity: 0.5;">üìé 0</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-implemented">–í–Ω–µ–¥—Ä–µ–Ω</span></td>
                            <td><span class="urgency-badge urgency-planned">–ü–ª–∞–Ω–æ–≤–æ–µ</span></td>
                            <td>2025-11-01 12:00</td>
                            <td>–ö–æ–∑–ª–æ–≤ –ö.</td>
                            <td>2025-10-28 11:45</td>
                            <td>
                                <div class="action-buttons">
                                <button class="btn-view" onclick="openRfcModal(4)">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    <button class="btn-edit" onclick="openEditRfcModal(4)" disabled title="RFC —É–∂–µ –≤–Ω–µ–¥—Ä–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </td>
                        </tr>

                        <!-- Sample RFC 5 -->
                        <tr data-rfc-id="5">
                            <td><a href="#" class="rfc-id-link">RFC-005</a></td>
                            <td>
                                <div style="font-weight: 500; margin-bottom: 4px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    <span title="–°–∏—Å—Ç–µ–º—ã">üñ•Ô∏è 1</span> ¬∑ 
                                    <span title="–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã">üì¶ 2</span> ¬∑ 
                                    <span title="–í–ª–æ–∂–µ–Ω–∏—è" style="opacity: 0.5;">üìé 0</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω</span></td>
                            <td><span class="urgency-badge urgency-planned">–ü–ª–∞–Ω–æ–≤–æ–µ</span></td>
                            <td>2025-11-20 10:00</td>
                            <td>–ú–æ—Ä–æ–∑–æ–≤–∞ –ú.</td>
                            <td>2025-11-01 09:00</td>
                            <td>
                                <div class="action-buttons">
                                <button class="btn-view" onclick="openRfcModal(5)">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    <button class="btn-edit" onclick="openEditRfcModal(5)" disabled title="RFC –æ—Ç–∫–ª–æ–Ω–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </td>
                        </tr>

                        <!-- Sample RFC 6 -->
                        <tr data-rfc-id="6">
                            <td><a href="#" class="rfc-id-link">RFC-006</a></td>
                            <td>
                                <div style="font-weight: 500; margin-bottom: 4px;">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    <span title="–°–∏—Å—Ç–µ–º—ã">üñ•Ô∏è 1</span> ¬∑ 
                                    <span title="–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã">üì¶ 2</span> ¬∑ 
                                    <span title="–í–ª–æ–∂–µ–Ω–∏—è">üìé 3</span>
                                </div>
                            </td>
                            <td><span class="status-badge status-under-review">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</span></td>
                            <td><span class="urgency-badge urgency-urgent">–°—Ä–æ—á–Ω–æ–µ</span></td>
                            <td>2025-11-08 15:00</td>
                            <td>–ù–æ–≤–∏–∫–æ–≤ –ù.</td>
                            <td>2025-11-03 13:25</td>
                            <td>
                                <div class="action-buttons">
                                <button class="btn-view" onclick="openRfcModal(6)">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                    <button class="btn-edit" onclick="openEditRfcModal(6)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Pagination - based on PageResponse from OpenAPI spec -->
                <div class="pagination">
                    <div class="pagination-info" id="paginationInfo">
                        –ü–æ–∫–∞–∑–∞–Ω–æ 1-6 –∏–∑ 6 –∑–∞–ø–∏—Å–µ–π (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1)
                    </div>
                    <div class="pagination-controls" id="paginationControls">
                        <button class="pagination-btn" id="prevPageBtn" disabled>‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                        <div id="pageNumbers" style="display: flex; gap: 5px;">
                            <button class="pagination-btn active">1</button>
                        </div>
                        <button class="pagination-btn" id="nextPageBtn" disabled>–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- RFC Details Modal -->
    <div class="modal-overlay" id="rfcModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">RFC Details</h2>
                <button class="modal-close" onclick="closeRfcModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be populated dynamically -->
            </div>
            <div class="modal-footer" id="modalFooter" style="display: none;">
                <button class="btn-danger" id="deleteRfcBtn" onclick="openDeleteConfirmModal()">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å RFC
                </button>
                <button class="btn btn-secondary" onclick="closeRfcModal()">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Create RFC Modal -->
    <div class="modal-overlay create-rfc-modal" id="createRfcModal">
        <div class="modal">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π RFC</h2>
                <button class="modal-close" onclick="closeCreateRfcModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="rfc-form">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <div class="form-section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                        
                        <div class="form-group">
                            <label for="rfc-title">
                                –ù–∞–∑–≤–∞–Ω–∏–µ RFC
                                <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="rfc-title" 
                                name="title" 
                                maxlength="255" 
                                required
                                placeholder="–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
                            >
                            <div class="field-counter">
                                <span id="title-counter">0</span> / 255
                            </div>
                            <div class="error-message">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                        </div>

                        <div class="form-group">
                            <label for="rfc-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea 
                                id="rfc-description" 
                                name="description" 
                                maxlength="5000"
                                placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø—Ä–∏—á–∏–Ω—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è"
                            ></textarea>
                            <div class="field-counter">
                                <span id="description-counter">0</span> / 5000
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="rfc-implementationDate">
                                –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
                                <span class="required">*</span>
                            </label>
                            <input 
                                type="datetime-local" 
                                id="rfc-implementationDate" 
                                name="implementationDate" 
                                required
                            >
                            <div class="field-hint">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–æ</div>
                            <div class="error-message">–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                        </div>

                        <div class="form-group">
                            <label for="rfc-urgency">
                                –°—Ä–æ—á–Ω–æ—Å—Ç—å
                                <span class="required">*</span>
                            </label>
                            <select id="rfc-urgency" name="urgency" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ—á–Ω–æ—Å—Ç—å</option>
                                <option value="PLANNED">–ü–ª–∞–Ω–æ–≤–æ–µ</option>
                                <option value="URGENT">–°—Ä–æ—á–Ω–æ–µ (–≤–Ω–µ –ø–ª–∞–Ω–∞)</option>
                                <option value="EMERGENCY">–ë–µ–∑–æ—Ç–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ</option>
                            </select>
                            <div class="error-message">–°—Ä–æ—á–Ω–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                        </div>
                    </div>

                    <!-- Affected Systems -->
                    <div class="form-section">
                        <div class="form-section-title">–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã</div>
                        
                        <div class="affected-systems-list" id="affected-systems-list">
                            <!-- Systems will be added dynamically -->
                        </div>

                        <button type="button" class="btn-add btn-add-system" id="add-system-btn">
                            + –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
                        </button>

                        <div class="error-message" id="systems-error" style="margin-top: 10px;">
                            –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Å–∏—Å—Ç–µ–º—É —Å –ø–æ–¥—Å–∏—Å—Ç–µ–º–æ–π
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateRfcModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary" id="submit-rfc-btn">
                            –°–æ–∑–¥–∞—Ç—å RFC
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit RFC Modal -->
    <div class="modal-overlay create-rfc-modal" id="editRfcModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="editRfcModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å RFC</h2>
                <button class="modal-close" onclick="closeEditRfcModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="edit-rfc-form">
                    <!-- Hidden field for RFC ID -->
                    <input type="hidden" id="edit-rfc-id" name="rfcId">

                    <!-- Basic Information -->
                    <div class="form-section">
                        <div class="form-section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                        
                        <div class="form-group">
                            <label for="edit-rfc-title">
                                –ù–∞–∑–≤–∞–Ω–∏–µ RFC
                                <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="edit-rfc-title" 
                                name="title" 
                                maxlength="255" 
                                required
                                placeholder="–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
                            >
                            <div class="field-counter">
                                <span id="edit-title-counter">0</span> / 255
                            </div>
                            <div class="error-message">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                        </div>

                        <div class="form-group">
                            <label for="edit-rfc-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea 
                                id="edit-rfc-description" 
                                name="description" 
                                maxlength="5000"
                                placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø—Ä–∏—á–∏–Ω—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è"
                            ></textarea>
                            <div class="field-counter">
                                <span id="edit-description-counter">0</span> / 5000
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="edit-rfc-implementationDate">
                                –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
                                <span class="required">*</span>
                            </label>
                            <input 
                                type="datetime-local" 
                                id="edit-rfc-implementationDate" 
                                name="implementationDate" 
                                required
                            >
                            <div class="field-hint">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–æ</div>
                            <div class="error-message">–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                        </div>

                        <div class="form-group">
                            <label for="edit-rfc-urgency">
                                –°—Ä–æ—á–Ω–æ—Å—Ç—å
                                <span class="required">*</span>
                            </label>
                            <select id="edit-rfc-urgency" name="urgency" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ—á–Ω–æ—Å—Ç—å</option>
                                <option value="PLANNED">–ü–ª–∞–Ω–æ–≤–æ–µ</option>
                                <option value="URGENT">–°—Ä–æ—á–Ω–æ–µ (–≤–Ω–µ –ø–ª–∞–Ω–∞)</option>
                                <option value="EMERGENCY">–ë–µ–∑–æ—Ç–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ</option>
                            </select>
                            <div class="error-message">–°—Ä–æ—á–Ω–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                        </div>
                    </div>

                    <!-- Affected Systems -->
                    <div class="form-section">
                        <div class="form-section-title">–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã</div>
                        
                        <div class="affected-systems-list" id="edit-affected-systems-list">
                            <!-- Systems will be added dynamically -->
                        </div>

                        <button type="button" class="btn-add btn-add-system" id="edit-add-system-btn">
                            + –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
                        </button>

                        <div class="error-message" id="edit-systems-error" style="margin-top: 10px;">
                            –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Å–∏—Å—Ç–µ–º—É —Å –ø–æ–¥—Å–∏—Å—Ç–µ–º–æ–π
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEditRfcModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary" id="update-rfc-btn">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay delete-confirm-modal" id="deleteConfirmModal">
        <div class="modal">
            <div class="modal-header">
                <h2>‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h2>
                <button class="modal-close" onclick="closeDeleteConfirmModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ! –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.</strong>
                    –£–¥–∞–ª–µ–Ω–∏–µ RFC –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ–º—É —É–¥–∞–ª–µ–Ω–∏—é –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
                    <ul style="margin: 8px 0 0 20px; padding: 0;">
                        <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∏ –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞—Ö</li>
                        <li>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∞—É–¥–∏—Ç</li>
                        <li>–í—Å–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</li>
                        <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∑–∞–º–µ—Ç–∫–∏</li>
                    </ul>
                </div>

                <div class="delete-rfc-info">
                    <div class="delete-rfc-info-label">–£–¥–∞–ª—è–µ–º—ã–π RFC</div>
                    <div class="delete-rfc-info-value" id="deleteRfcTitle"></div>
                </div>

                <div class="delete-confirm-input">
                    <label for="deleteConfirmInput">
                        –î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ RFC:
                    </label>
                    <input 
                        type="text" 
                        id="deleteConfirmInput" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ RFC"
                        autocomplete="off"
                    >
                    <div class="field-hint">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeDeleteConfirmModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn-danger" id="confirmDeleteBtn" onclick="confirmDeleteRfc()" disabled>
                    –£–¥–∞–ª–∏—Ç—å RFC
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon" id="toast-icon">‚úì</div>
        <div class="toast-content">
            <div class="toast-title" id="toast-title">–£—Å–ø–µ—à–Ω–æ</div>
            <div class="toast-message" id="toast-message">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
        </div>
        <button class="toast-close" onclick="hideToast()">√ó</button>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script>
        /**
         * RFC List Page - OpenAPI Contract Compliance
         * 
         * Data Structures:
         * 
         * UserResponse (from api/user/model/User.yaml):
         * - id: integer(int64) - Unique user identifier
         * - username: string - Username
         * - firstName: string - First name
         * - lastName: string - Last name
         * - role: UserRole enum (REQUESTER, EXECUTOR, CAB_MANAGER, ADMIN)
         * 
         * RfcPageResponse (from api/rfc/model/Rfc.yaml):
         * Extends PageResponse from Common.yaml with:
         * - content: array of RfcResponse
         * - totalElements: integer(int64) - Total number of RFC items
         * - totalPages: integer - Total number of pages
         * - size: integer - Page size (fixed to 20 as per pageable-size default)
         * - number: integer - Current page number (0-indexed as per pageable-page parameter)
         * - first: boolean - Is first page
         * - last: boolean - Is last page
         * 
         * RfcResponse (from api/rfc/model/Rfc.yaml):
         * - id: integer(int64) - Unique RFC identifier
         * - title: string - RFC title
         * - description: string (nullable) - Change description
         * - implementationDate: string(date-time) - Implementation date
         * - urgency: Urgency enum (EMERGENCY, URGENT, PLANNED)
         * - status: RfcStatus enum (NEW, UNDER_REVIEW, APPROVED, IMPLEMENTED, REJECTED)
         * - requesterId: integer(int64) - Creator user ID
         * - affectedSystems: array of AffectedSystemResponse
         *   - id: integer(int64) - System relation ID
         *   - systemId: integer(int64) - System ID
         *   - systemName: string - System name
         *   - affectedSubsystems: array of AffectedSubsystemResponse
         *     - id: integer(int64) - Subsystem relation ID
         *     - subsystemId: integer(int64) - Subsystem ID
         *     - subsystemName: string - Subsystem name
         *     - executorId: integer(int64) - Executor user ID
         *     - executorName: string - Executor name
         *     - confirmationStatus: enum (PENDING, CONFIRMED, REJECTED)
         *     - executionStatus: enum (PENDING, IN_PROGRESS, DONE)
         * - attachments: array of AttachmentResponse
         *   - id: integer(int64) - Attachment ID
         *   - originalFilename: string - File name
         *   - fileSize: integer(int64) - Size in bytes
         *   - uploadedById: integer(int64) - Uploader user ID
         *   - uploadedByName: string - Uploader name
         *   - createDatetime: string(date-time) - Upload timestamp
         * - createDatetime: string(date-time) - Creation timestamp
         * - updateDatetime: string(date-time) - Last update timestamp
         * 
         * Table Display Format:
         * - User names: "LastName F." (e.g., "–ò–≤–∞–Ω–æ–≤ –ò.")
         * - Systems/Subsystems: "SystemName: subsystem1, subsystem2..."
         * - Attachments: "üìé N" (count)
         * - Dates: "üìÖ createDatetime" and "üîÑ updateDatetime"
         * 
         * Header Display Format:
         * - User names: "FirstName LastName" (e.g., "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤")
         * - User avatar initials: "FL" (e.g., "–ò–ò")
         */
        
        document.addEventListener('DOMContentLoaded', function() {
            // Simulated current user data (in real app, would come from authentication)
            // Following UserResponse schema from OpenAPI spec
            const currentUser = {
                id: 1,
                username: 'i.ivanov',
                firstName: '–ò–≤–∞–Ω',
                lastName: '–ò–≤–∞–Ω–æ–≤',
                role: 'ADMIN' // REQUESTER, EXECUTOR, CAB_MANAGER, ADMIN
            };

            // Initialize user info in header
            initializeUserInfo(currentUser);

            const currentUserId = currentUser.id;
            // Format: "LastName F." for display in table (matching RfcResponse format)
            const currentUserFullName = `${currentUser.lastName} ${currentUser.firstName.charAt(0)}.`;

            // Initialize pagination with sample data matching PageResponse schema
            // In real app, this would come from API response: GET /rfc?page=0&size=20
            // Following pageable-page (0-indexed) and pageable-size (default: 20) parameters
            // Simulating scenario with multiple pages for demonstration
            const rfcItemsCount = document.querySelectorAll('.rfc-table tbody tr').length;
            
            const samplePageResponse = {
                content: [], // RFC array (already in DOM, showing actual count)
                totalElements: 156, // Total RFC count across all pages (simulated)
                totalPages: 8,      // ceil(156 / 20) = 8 pages
                size: 20,           // Items per page (fixed as per requirement)
                number: 0,          // Current page (0-indexed as per pageable-page parameter)
                first: true,        // This is the first page
                last: false         // Not the last page
            };
            
            updatePaginationUI(samplePageResponse);

            // Table row click handler (removed - using button instead)
            // const rows = document.querySelectorAll('.rfc-table tbody tr');
            // rows.forEach(row => {
            //     row.addEventListener('click', function(e) {
            //         // Don't navigate if clicking on a link or button
            //         if (e.target.tagName !== 'A' && e.target.tagName !== 'BUTTON' && !e.target.closest('button')) {
            //             const rfcId = this.getAttribute('data-rfc-id');
            //             if (rfcId) {
            //                 openRfcModal(parseInt(rfcId));
            //             }
            //         }
            //     });
            // });

            // Filter handlers
            const statusFilter = document.getElementById('status-filter');
            const urgencyFilter = document.getElementById('urgency-filter');
            const requesterFilter = document.getElementById('requester-filter');
            const myRfcFilter = document.getElementById('my-rfc-filter');

            statusFilter.addEventListener('change', function() {
                console.log('Status filter changed:', this.value);
                applyFilters();
            });

            urgencyFilter.addEventListener('change', function() {
                console.log('Urgency filter changed:', this.value);
                applyFilters();
            });

            requesterFilter.addEventListener('input', function() {
                console.log('Requester filter changed:', this.value);
                applyFilters();
            });

            // My RFC filter handler
            myRfcFilter.addEventListener('change', function() {
                console.log('My RFC filter:', this.checked);
                if (this.checked) {
                    // Auto-fill requester filter with current user ID
                    requesterFilter.value = currentUserId;
                    requesterFilter.disabled = true;
                    requesterFilter.style.opacity = '0.6';
                } else {
                    // Clear and enable requester filter
                    requesterFilter.value = '';
                    requesterFilter.disabled = false;
                    requesterFilter.style.opacity = '1';
                }
                applyFilters();
            });

            // Apply filters function
            function applyFilters() {
                const rows = document.querySelectorAll('.rfc-table tbody tr');
                let visibleCount = 0;

                rows.forEach(row => {
                    let shouldShow = true;

                    // Status filter
                    if (statusFilter.value) {
                        const statusBadge = row.querySelector('.status-badge');
                        const statusText = statusBadge.textContent.trim().toUpperCase();
                        const statusValue = statusFilter.value;
                        
                        const statusMap = {
                            'NEW': '–ù–û–í–´–ô',
                            'UNDER_REVIEW': '–ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò',
                            'APPROVED': '–û–î–û–ë–†–ï–ù',
                            'IMPLEMENTED': '–í–ù–ï–î–†–ï–ù',
                            'REJECTED': '–û–¢–ö–õ–û–ù–ï–ù'
                        };
                        
                        if (statusMap[statusValue] !== statusText) {
                            shouldShow = false;
                        }
                    }

                    // Urgency filter
                    if (urgencyFilter.value && shouldShow) {
                        const urgencyBadge = row.querySelector('.urgency-badge');
                        const urgencyText = urgencyBadge.textContent.trim().toUpperCase();
                        const urgencyValue = urgencyFilter.value;
                        
                        const urgencyMap = {
                            'EMERGENCY': '–ë–ï–ó–û–¢–õ–ê–ì–ê–¢–ï–õ–¨–ù–û–ï',
                            'URGENT': '–°–†–û–ß–ù–û–ï',
                            'PLANNED': '–ü–õ–ê–ù–û–í–û–ï'
                        };
                        
                        if (urgencyMap[urgencyValue] !== urgencyText) {
                            shouldShow = false;
                        }
                    }

                    // Requester filter (or My RFC filter)
                    if (requesterFilter.value && shouldShow) {
                        const creatorCell = row.cells[5]; // Creator column (0-indexed: ID=0, Title=1, Status=2, Urgency=3, Date=4, Creator=5)
                        const creatorName = creatorCell.textContent.trim();
                        
                        // In real app, would compare by ID from RfcResponse.requesterId
                        // For demo, we check if "My RFC" is checked and compare names
                        if (myRfcFilter.checked) {
                            if (creatorName !== currentUserFullName) {
                                shouldShow = false;
                            }
                        }
                    }

                    // Show/hide row
                    if (shouldShow) {
                        row.style.display = '';
                        visibleCount++;
                    } else {
                        row.style.display = 'none';
                    }
                });

                // Update pagination info
                updatePaginationInfo(visibleCount, rows.length);
            }

            // Update pagination information
            function updatePaginationInfo(visible, total) {
                const paginationInfo = document.querySelector('.pagination-info');
                if (visible === 0) {
                    paginationInfo.textContent = '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                } else if (visible === total) {
                    paginationInfo.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ 1-${visible} –∏–∑ ${total} –∑–∞–ø–∏—Å–µ–π`;
                } else {
                    paginationInfo.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${visible} –∏–∑ ${total} –∑–∞–ø–∏—Å–µ–π (–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ)`;
                }
            }

            // Update pagination UI based on PageResponse from API
            // Following PageResponse schema from Common.yaml
            function updatePaginationUI(pageResponse) {
                const {
                    totalElements,
                    totalPages,
                    size,
                    number,  // 0-indexed current page
                    first,
                    last
                } = pageResponse;

                const paginationInfo = document.getElementById('paginationInfo');
                const prevBtn = document.getElementById('prevPageBtn');
                const nextBtn = document.getElementById('nextPageBtn');
                const pageNumbers = document.getElementById('pageNumbers');

                // Calculate display range
                const startItem = number * size + 1;
                const endItem = Math.min((number + 1) * size, totalElements);

                // Update info text
                if (totalElements === 0) {
                    paginationInfo.textContent = '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                } else {
                    paginationInfo.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${startItem}-${endItem} –∏–∑ ${totalElements} –∑–∞–ø–∏—Å–µ–π (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ ${number + 1} –∏–∑ ${totalPages})`;
                }

                // Update Previous button
                prevBtn.disabled = first;

                // Update Next button
                nextBtn.disabled = last;

                // Generate page number buttons
                pageNumbers.innerHTML = '';
                
                // Show max 5 page buttons
                const maxButtons = 5;
                let startPage = Math.max(0, number - Math.floor(maxButtons / 2));
                let endPage = Math.min(totalPages - 1, startPage + maxButtons - 1);
                
                // Adjust if at the end
                if (endPage - startPage < maxButtons - 1) {
                    startPage = Math.max(0, endPage - maxButtons + 1);
                }

                // First page button
                if (startPage > 0) {
                    const firstBtn = document.createElement('button');
                    firstBtn.className = 'pagination-btn';
                    firstBtn.textContent = '1';
                    firstBtn.onclick = () => goToPage(0);
                    pageNumbers.appendChild(firstBtn);
                    
                    if (startPage > 1) {
                        const dots = document.createElement('span');
                        dots.className = 'pagination-dots';
                        dots.textContent = '...';
                        pageNumbers.appendChild(dots);
                    }
                }

                // Page number buttons
                for (let i = startPage; i <= endPage; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'pagination-btn' + (i === number ? ' active' : '');
                    btn.textContent = i + 1;
                    btn.onclick = () => goToPage(i);
                    pageNumbers.appendChild(btn);
                }

                // Last page button
                if (endPage < totalPages - 1) {
                    if (endPage < totalPages - 2) {
                        const dots = document.createElement('span');
                        dots.className = 'pagination-dots';
                        dots.textContent = '...';
                        pageNumbers.appendChild(dots);
                    }
                    
                    const lastBtn = document.createElement('button');
                    lastBtn.className = 'pagination-btn';
                    lastBtn.textContent = totalPages;
                    lastBtn.onclick = () => goToPage(totalPages - 1);
                    pageNumbers.appendChild(lastBtn);
                }

                // Update button click handlers
                prevBtn.onclick = () => {
                    if (!first) {
                        goToPage(number - 1);
                    }
                };

                nextBtn.onclick = () => {
                    if (!last) {
                        goToPage(number + 1);
                    }
                };
            }

            // Navigate to specific page (0-indexed)
            // In real app, make API call: GET /rfc?page=${pageNumber}&size=20&status=...&urgency=...&requesterId=...
            function goToPage(pageNumber) {
                console.log('Navigate to page:', pageNumber);
                // In real app, make API call with page parameter (size is always 20)
                // const statusFilter = document.getElementById('status-filter').value;
                // const urgencyFilter = document.getElementById('urgency-filter').value;
                // const requesterIdFilter = document.getElementById('requester-filter').value;
                // 
                // let url = `/api/rfc?page=${pageNumber}&size=20`;
                // if (statusFilter) url += `&status=${statusFilter}`;
                // if (urgencyFilter) url += `&urgency=${urgencyFilter}`;
                // if (requesterIdFilter) url += `&requesterId=${requesterIdFilter}`;
                // 
                // const response = await fetch(url, {
                //     headers: { 'Authorization': 'Bearer ' + getAuthToken() }
                // });
                // const pageResponse = await response.json(); // RfcPageResponse
                // 
                // Then update table and call updatePaginationUI with new PageResponse
                
                // For demo, just log
                alert(`–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å: GET /rfc?page=${pageNumber}&size=20`);
            }

            // Apply filters button
            const applyFiltersBtn = document.querySelector('.filters .btn-primary');
            applyFiltersBtn.addEventListener('click', function() {
                console.log('Applying filters...');
                applyFilters();
            });

            // Create RFC button
            const createBtn = document.getElementById('create-rfc-btn');
            createBtn.addEventListener('click', function() {
                openCreateRfcModal();
            });

            // Logout button
            const logoutBtn = document.getElementById('logout-btn');
            logoutBtn.addEventListener('click', function() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
                    console.log('Logging out...');
                    // In real app: clear session, tokens, redirect to login
                    // window.location.href = '/logout';
                    alert('–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω');
                }
            });

            // Initialize user info function
            // Following UserResponse schema from OpenAPI spec
            function initializeUserInfo(user) {
                const userAvatar = document.getElementById('user-avatar');
                const userName = document.getElementById('user-name');
                const userRoleBadge = document.getElementById('user-role-badge');

                // Set avatar initials from firstName and lastName
                const initials = `${user.firstName.charAt(0)}${user.lastName.charAt(0)}`;
                userAvatar.textContent = initials;

                // Set user name as "firstName lastName"
                const fullName = `${user.firstName} ${user.lastName}`;
                userName.textContent = fullName;

                // Set role badge according to UserRole enum from Common.yaml
                const roleMap = {
                    'REQUESTER': { class: 'role-requester', text: '–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä' },
                    'EXECUTOR': { class: 'role-executor', text: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å' },
                    'CAB_MANAGER': { class: 'role-cab-manager', text: '–ú–µ–Ω–µ–¥–∂–µ—Ä CAB' },
                    'ADMIN': { class: 'role-admin', text: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }
                };

                const roleInfo = roleMap[user.role] || roleMap['REQUESTER'];
                userRoleBadge.className = 'role-badge ' + roleInfo.class;
                userRoleBadge.textContent = roleInfo.text;
            }
        });

        // Global variable to store current RFC being viewed
        let currentViewedRfc = null;

        // Modal functions - defined globally for onclick handlers
        function openRfcModal(rfcId) {
            const rfcData = getRfcData(rfcId);
            if (!rfcData) {
                console.error('RFC not found:', rfcId);
                return;
            }

            // Store current RFC for delete operation
            currentViewedRfc = rfcData;

            const modal = document.getElementById('rfcModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalFooter = document.getElementById('modalFooter');
            const deleteBtn = document.getElementById('deleteRfcBtn');

            modalTitle.textContent = `RFC-${String(rfcId).padStart(3, '0')}`;
            modalBody.innerHTML = generateModalContent(rfcData);

            // Show/hide delete button based on status and permissions
            // Can delete only if:
            // 1. Status is not APPROVED, IMPLEMENTED, or REJECTED
            // 2. Current user is the creator OR has ADMIN role
            const currentUser = {
                id: 1,
                username: 'i.ivanov',
                firstName: '–ò–≤–∞–Ω',
                lastName: '–ò–≤–∞–Ω–æ–≤',
                role: 'ADMIN' // REQUESTER, EXECUTOR, CAB_MANAGER, ADMIN
            };

            const canDelete = 
                !['APPROVED', 'IMPLEMENTED', 'REJECTED'].includes(rfcData.status) &&
                (currentUser.id === rfcData.requesterId || currentUser.role === 'ADMIN');

            if (canDelete) {
                modalFooter.style.display = 'flex';
                deleteBtn.disabled = false;
            } else {
                modalFooter.style.display = 'none';
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeRfcModal() {
            const modal = document.getElementById('rfcModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // ============= EDIT RFC MODAL FUNCTIONS (GLOBAL) =============
        
        // Open edit RFC modal - reuses create RFC logic
        function openEditRfcModal(rfcId) {
            const rfcData = getRfcData(rfcId);
            
            if (!rfcData) {
                showToast('error', '–û—à–∏–±–∫–∞', 'RFC –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // Check if RFC can be edited (not APPROVED, IMPLEMENTED, or REJECTED)
            if (['APPROVED', 'IMPLEMENTED', 'REJECTED'].includes(rfcData.status)) {
                showToast('error', '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ', 'RFC –≤ —Å—Ç–∞—Ç—É—Å–µ "' + rfcData.status + '" –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω');
                return;
            }

            const modal = document.getElementById('editRfcModal');
            const modalTitle = document.getElementById('editRfcModalTitle');
            
            modalTitle.textContent = `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å RFC-${String(rfcId).padStart(3, '0')}`;

            // Load reference data first (reuse from create RFC)
            loadReferenceDataForRfcCreation().then(async () => {
                // Pre-populate form with RFC data
                await populateEditRfcForm(rfcData);
                
                // Show modal
                modal.classList.add('active');
            });
        }

        // Close edit RFC modal
        function closeEditRfcModal() {
            const modal = document.getElementById('editRfcModal');
            modal.classList.remove('active');
            
            // Reset form after animation
            setTimeout(() => {
                resetEditRfcForm();
            }, 300);
        }

        // Reset edit RFC form
        function resetEditRfcForm() {
            document.getElementById('edit-rfc-form').reset();
            document.getElementById('edit-affected-systems-list').innerHTML = '';
            document.getElementById('edit-title-counter').textContent = '0';
            document.getElementById('edit-description-counter').textContent = '0';
            systemCounter = 0;
            subsystemCounter = 0;
        }

        // Populate edit form with RFC data
        async function populateEditRfcForm(rfcData) {
            // Set RFC ID
            document.getElementById('edit-rfc-id').value = rfcData.id;

            // Set basic fields
            const titleInput = document.getElementById('edit-rfc-title');
            titleInput.value = rfcData.title;
            document.getElementById('edit-title-counter').textContent = rfcData.title.length;

            const descriptionInput = document.getElementById('edit-rfc-description');
            descriptionInput.value = rfcData.description || '';
            document.getElementById('edit-description-counter').textContent = (rfcData.description || '').length;

            // Set implementation date (convert ISO to datetime-local format)
            const implementationDate = new Date(rfcData.implementationDate);
            const dateStr = implementationDate.toISOString().slice(0, 16);
            document.getElementById('edit-rfc-implementationDate').value = dateStr;

            // Set urgency
            document.getElementById('edit-rfc-urgency').value = rfcData.urgency;

            // Clear existing systems
            document.getElementById('edit-affected-systems-list').innerHTML = '';
            systemCounter = 0;
            subsystemCounter = 0;

            // Add affected systems using create RFC logic - async to load subsystems first
            for (const system of rfcData.affectedSystems) {
                await addEditSystemCardWithData(system);
            }
        }

        // Add system card with pre-populated data (async version for edit mode)
        async function addEditSystemCardWithData(systemData) {
            const systemId = `edit-system-${systemCounter++}`;
            const systemsList = document.getElementById('edit-affected-systems-list');

            const systemCard = document.createElement('div');
            systemCard.className = 'system-card';
            systemCard.id = systemId;

            systemCard.innerHTML = `
                <div class="system-card-header">
                    <div class="system-card-title">–°–∏—Å—Ç–µ–º–∞ ${systemCounter}</div>
                    <button type="button" class="btn-remove" onclick="removeEditSystemCard('${systemId}')">‚úï</button>
                </div>
                <div class="system-card-body">
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É <span class="required">*</span></label>
                        <select class="system-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É</option>
                            ${systemsData.map(sys => `<option value="${sys.id}">${sys.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="subsystems-container" id="${systemId}-subsystems">
                        <!-- Subsystems will be added here -->
                    </div>
                    <button type="button" class="btn-add" onclick="addEditSubsystemCard('${systemId}')">
                        + –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∏—Å—Ç–µ–º—É
                    </button>
                </div>
            `;

            systemsList.appendChild(systemCard);

            const systemSelect = systemCard.querySelector('.system-select');
            
            // Set the system value
            systemSelect.value = systemData.systemId;
            
            // Load subsystems for this system
            await handleSystemChange(systemId, systemData.systemId);
            
            // Now add subsystems after they are loaded
            if (systemData.affectedSubsystems && systemData.affectedSubsystems.length > 0) {
                for (const subsystem of systemData.affectedSubsystems) {
                    addEditSubsystemCard(systemId, subsystem);
                }
            }

            // Add change listener for future changes
            systemSelect.addEventListener('change', async function() {
                await handleEditSystemChange(systemId, this.value);
            });
        }

        // Add system card in edit mode - wrapper around create RFC function
        function addEditSystemCard(systemData = null) {
            const systemId = `edit-system-${systemCounter++}`;
            const systemsList = document.getElementById('edit-affected-systems-list');

            const systemCard = document.createElement('div');
            systemCard.className = 'system-card';
            systemCard.id = systemId;

            systemCard.innerHTML = `
                <div class="system-card-header">
                    <div class="system-card-title">–°–∏—Å—Ç–µ–º–∞ ${systemCounter}</div>
                    <button type="button" class="btn-remove" onclick="removeEditSystemCard('${systemId}')">‚úï</button>
                </div>
                <div class="system-card-body">
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É <span class="required">*</span></label>
                        <select class="system-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É</option>
                            ${systemsData.map(sys => `<option value="${sys.id}">${sys.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="subsystems-container" id="${systemId}-subsystems">
                        <!-- Subsystems will be added here -->
                    </div>
                    <button type="button" class="btn-add" onclick="addEditSubsystemCard('${systemId}')">
                        + –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∏—Å—Ç–µ–º—É
                    </button>
                </div>
            `;

            systemsList.appendChild(systemCard);

            const systemSelect = systemCard.querySelector('.system-select');
            
            // If we have systemData, pre-populate
            if (systemData) {
                systemSelect.value = systemData.systemId;
                
                // Add subsystems
                systemData.affectedSubsystems.forEach(subsystem => {
                    addEditSubsystemCard(systemId, subsystem);
                });
            }

            // Add change listener - reuse create RFC logic
            systemSelect.addEventListener('change', async function() {
                await handleEditSystemChange(systemId, this.value);
            });
        }

        // Handle system change in edit mode - reuses create RFC logic
        async function handleEditSystemChange(systemId, selectedSystemId) {
            const subsystemsContainer = document.getElementById(`${systemId}-subsystems`);
            
            // Clear existing subsystems when system changes
            const shouldClear = subsystemsContainer.children.length > 0;
            if (shouldClear) {
                if (!confirm('–°–º–µ–Ω–∞ —Å–∏—Å—Ç–µ–º—ã —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                    // Revert selection
                    const systemCard = document.getElementById(systemId);
                    const systemSelect = systemCard.querySelector('.system-select');
                    systemSelect.value = '';
                    return;
                }
            }

            // Use the same logic as create RFC - load subsystems
            await handleSystemChange(systemId, selectedSystemId);
        }

        // Add subsystem card in edit mode - reuses create RFC logic
        function addEditSubsystemCard(systemId, subsystemData = null) {
            const subsystemId = `edit-subsystem-${subsystemCounter++}`;
            const subsystemsContainer = document.getElementById(`${systemId}-subsystems`);

            // Get selected system
            const systemCard = document.getElementById(systemId);
            const systemSelect = systemCard.querySelector('.system-select');
            const selectedSystemId = parseInt(systemSelect.value);

            if (!selectedSystemId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É');
                return;
            }

            // Get subsystems from dataset (loaded by handleSystemChange)
            const subsystemsJson = systemCard.dataset.subsystems;
            if (!subsystemsJson) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã');
                return;
            }

            const subsystems = JSON.parse(subsystemsJson);
            if (subsystems.length === 0) {
                alert('–£ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º');
                return;
            }

            const subsystemCard = document.createElement('div');
            subsystemCard.className = 'subsystem-card';
            subsystemCard.id = subsystemId;

            subsystemCard.innerHTML = `
                <div class="subsystem-card-header">
                    <div class="subsystem-card-title">–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ ${subsystemCounter}</div>
                    <button type="button" class="btn-remove-small" onclick="removeEditSubsystemCard('${subsystemId}')">‚úï</button>
                </div>
                <div class="subsystem-card-body">
                    <div class="form-group">
                        <label>–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ <span class="required">*</span></label>
                        <select class="subsystem-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—É</option>
                            ${subsystems.map(sub => `<option value="${sub.id}" data-team-id="${sub.teamId}">${sub.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group" id="${subsystemId}-executor-group" style="display: none;">
                        <label>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å <span class="required">*</span></label>
                        <select class="executor-select" required disabled>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                        </select>
                    </div>
                </div>
            `;

            subsystemsContainer.appendChild(subsystemCard);

            const subsystemSelect = subsystemCard.querySelector('.subsystem-select');
            const executorGroup = subsystemCard.querySelector(`#${subsystemId}-executor-group`);
            const executorSelect = subsystemCard.querySelector('.executor-select');

            // If we have subsystemData, pre-populate
            if (subsystemData) {
                subsystemSelect.value = subsystemData.subsystemId;
                
                // Load executors for this subsystem - reuse create RFC logic
                handleSubsystemChange(subsystemId, subsystemData.subsystemId, null);
                
                // Set executor after a short delay to ensure options are loaded
                setTimeout(() => {
                    executorSelect.value = subsystemData.executorId;
                }, 50);
            }

            // Add change listener - reuse create RFC logic
            subsystemSelect.addEventListener('change', function() {
                const selectedSubsystemId = parseInt(this.value);
                const selectedOption = this.options[this.selectedIndex];
                const teamId = selectedOption ? selectedOption.dataset.teamId : null;
                handleSubsystemChange(subsystemId, selectedSubsystemId, teamId);
            });
        }

        // Remove system card in edit mode
        function removeEditSystemCard(systemId) {
            const systemCard = document.getElementById(systemId);
            if (systemCard) {
                systemCard.remove();
            }
        }

        // Remove subsystem card in edit mode
        function removeEditSubsystemCard(subsystemId) {
            const subsystemCard = document.getElementById(subsystemId);
            if (subsystemCard) {
                subsystemCard.remove();
            }
        }

        // Toast functions - defined globally
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');

            toast.className = 'toast show ' + type;
            toastIcon.textContent = type === 'success' ? '‚úì' : '‚úï';
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        }

        // Loading overlay functions - defined globally
        function showLoading() {
            document.getElementById('loading-overlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('show');
        }

        // Close modal on overlay click
        document.getElementById('rfcModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeRfcModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeRfcModal();
                closeEditRfcModal();
                closeDeleteConfirmModal();
            }
        });

        // ============= DELETE RFC FUNCTIONS =============

        // Open delete confirmation modal
        function openDeleteConfirmModal() {
            if (!currentViewedRfc) {
                showToast('error', '–û—à–∏–±–∫–∞', 'RFC –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // Check if RFC can be deleted
            if (['APPROVED', 'IMPLEMENTED', 'REJECTED'].includes(currentViewedRfc.status)) {
                showToast('error', '–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ', 'RFC –≤ —Å—Ç–∞—Ç—É—Å–µ "' + currentViewedRfc.status + '" –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω');
                return;
            }

            const deleteModal = document.getElementById('deleteConfirmModal');
            const deleteRfcTitle = document.getElementById('deleteRfcTitle');
            const deleteConfirmInput = document.getElementById('deleteConfirmInput');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

            // Set RFC title to confirm
            deleteRfcTitle.textContent = currentViewedRfc.title;

            // Reset input and button state
            deleteConfirmInput.value = '';
            confirmDeleteBtn.disabled = true;

            // Show delete confirmation modal
            deleteModal.classList.add('active');
        }

        // Close delete confirmation modal
        function closeDeleteConfirmModal() {
            const deleteModal = document.getElementById('deleteConfirmModal');
            deleteModal.classList.remove('active');

            // Reset input
            document.getElementById('deleteConfirmInput').value = '';
            document.getElementById('confirmDeleteBtn').disabled = true;
        }

        // Close delete modal on overlay click
        document.getElementById('deleteConfirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDeleteConfirmModal();
            }
        });

        // Validate delete confirmation input
        document.getElementById('deleteConfirmInput').addEventListener('input', function() {
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const enteredTitle = this.value.trim();
            const actualTitle = currentViewedRfc ? currentViewedRfc.title : '';

            // Enable delete button only if titles match exactly
            if (enteredTitle === actualTitle) {
                confirmBtn.disabled = false;
            } else {
                confirmBtn.disabled = true;
            }
        });

        // Confirm and execute RFC deletion
        async function confirmDeleteRfc() {
            if (!currentViewedRfc) {
                showToast('error', '–û—à–∏–±–∫–∞', 'RFC –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            const rfcId = currentViewedRfc.id;
            const rfcTitle = currentViewedRfc.title;

            console.log('Deleting RFC:', rfcId);

            // Close delete confirmation modal
            closeDeleteConfirmModal();
            
            // Show loading overlay
            showLoading();

            try {
                // In real app, make DELETE request to /rfc/{id}
                // Following OpenAPI spec: DELETE /rfc/{id}
                // Returns 204 No Content on success
                //
                // const response = await fetch(`/api/rfc/${rfcId}`, {
                //     method: 'DELETE',
                //     headers: {
                //         'Authorization': 'Bearer ' + getAuthToken()
                //     }
                // });
                //
                // if (response.status === 204) {
                //     // Success - RFC deleted
                //     hideLoading();
                //     closeRfcModal();
                //     showToast('success', 'RFC —É–¥–∞–ª–µ–Ω', `RFC "${rfcTitle}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω`);
                //     
                //     // Redirect to RFC list after short delay
                //     setTimeout(() => {
                //         window.location.href = '/rfc-list.html';
                //     }, 2000);
                // } else if (response.status === 400) {
                //     const errorData = await response.json();
                //     hideLoading();
                //     showToast('error', '–û—à–∏–±–∫–∞', errorData.errors[0].message || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å RFC');
                // } else if (response.status === 404) {
                //     hideLoading();
                //     showToast('error', '–û—à–∏–±–∫–∞', 'RFC –Ω–µ –Ω–∞–π–¥–µ–Ω');
                // } else {
                //     hideLoading();
                //     showToast('error', '–û—à–∏–±–∫–∞', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ RFC');
                // }

                // Mock deletion - simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Simulate successful deletion
                hideLoading();
                closeRfcModal();
                
                showToast('success', 'RFC —É–¥–∞–ª–µ–Ω', `RFC "${rfcTitle}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω`);

                // Remove RFC from table (in real app, this would be done via page reload or state update)
                const rfcRow = document.querySelector(`tr[data-rfc-id="${rfcId}"]`);
                if (rfcRow) {
                    rfcRow.style.opacity = '0.5';
                    rfcRow.style.transition = 'opacity 0.3s ease';
                    
                    setTimeout(() => {
                        rfcRow.remove();
                        
                        // Update pagination info
                        const remainingRows = document.querySelectorAll('.rfc-table tbody tr').length;
                        const paginationInfo = document.querySelector('.pagination-info');
                        if (remainingRows === 0) {
                            paginationInfo.textContent = '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                            
                            // Show empty state
                            const tbody = document.querySelector('.rfc-table tbody');
                            tbody.innerHTML = `
                                <tr>
                                    <td colspan="8">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">üìã</div>
                                            <p>RFC –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        } else {
                            paginationInfo.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ 1-${remainingRows} –∏–∑ ${remainingRows} –∑–∞–ø–∏—Å–µ–π`;
                        }
                    }, 300);
                }

                // In real app, redirect to list or reload page
                // setTimeout(() => {
                //     window.location.reload();
                // }, 2000);

            } catch (error) {
                hideLoading();
                console.error('Error deleting RFC:', error);
                showToast('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å RFC. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }

        // RFC Data - defined globally for modal access
        function getRfcData(rfcId) {
            // Sample RFC data - in real app, fetch from API
            const rfcDatabase = {
                1: {
                    id: 1,
                    title: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                    description: '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∏ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.',
                    status: 'NEW',
                    urgency: 'PLANNED',
                    implementationDate: '2025-11-10T14:00:00',
                    requesterId: 1,
                    requesterName: '–ò–≤–∞–Ω–æ–≤ –ò.',
                    createDatetime: '2025-11-03T10:30:00',
                    updateDatetime: '2025-11-03T15:45:00',
                    affectedSystems: [
                        {
                            id: 1,
                            systemId: 1,
                            systemName: 'Auth System',
                            affectedSubsystems: [
                                {
                                    id: 1,
                                    subsystemId: 1,
                                    subsystemName: 'Auth Service',
                                    executorId: 2,
                                    executorName: '–ü–µ—Ç—Ä–æ–≤ –ü.',
                                    confirmationStatus: 'PENDING',
                                    executionStatus: 'PENDING'
                                },
                                {
                                    id: 2,
                                    subsystemId: 2,
                                    subsystemName: 'User DB',
                                    executorId: 3,
                                    executorName: '–°–∏–¥–æ—Ä–æ–≤–∞ –°.',
                                    confirmationStatus: 'CONFIRMED',
                                    executionStatus: 'PENDING'
                                }
                            ]
                        }
                    ],
                    attachments: [
                        {
                            originalFilename: 'database-schema.sql',
                            fileSize: 15360,
                            uploadedByName: '–ò–≤–∞–Ω–æ–≤ –ò.',
                            createDatetime: '2025-11-03T10:35:00'
                        },
                        {
                            originalFilename: 'migration-plan.pdf',
                            fileSize: 245760,
                            uploadedByName: '–ò–≤–∞–Ω–æ–≤ –ò.',
                            createDatetime: '2025-11-03T10:40:00'
                        }
                    ]
                },
                2: {
                    id: 2,
                    title: '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏',
                    description: '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ API Gateway, —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.',
                    status: 'UNDER_REVIEW',
                    urgency: 'EMERGENCY',
                    implementationDate: '2025-11-04T09:00:00',
                    requesterId: 2,
                    requesterName: '–ü–µ—Ç—Ä–æ–≤ –ü.',
                    createDatetime: '2025-11-03T08:15:00',
                    updateDatetime: '2025-11-03T09:30:00',
                    affectedSystems: [
                        {
                            id: 2,
                            systemId: 2,
                            systemName: 'Security System',
                            affectedSubsystems: [
                                {
                                    id: 3,
                                    subsystemId: 3,
                                    subsystemName: 'API Gateway',
                                    executorId: 4,
                                    executorName: '–ö–æ–∑–ª–æ–≤ –ö.',
                                    confirmationStatus: 'CONFIRMED',
                                    executionStatus: 'IN_PROGRESS'
                                },
                                {
                                    id: 4,
                                    subsystemId: 4,
                                    subsystemName: 'Security Module',
                                    executorId: 5,
                                    executorName: '–ú–æ—Ä–æ–∑–æ–≤–∞ –ú.',
                                    confirmationStatus: 'CONFIRMED',
                                    executionStatus: 'PENDING'
                                }
                            ]
                        }
                    ],
                    attachments: [
                        {
                            originalFilename: 'vulnerability-report.pdf',
                            fileSize: 512000,
                            uploadedByName: '–ü–µ—Ç—Ä–æ–≤ –ü.',
                            createDatetime: '2025-11-03T08:20:00'
                        }
                    ]
                }
                // Add more RFC data as needed
            };

            return rfcDatabase[rfcId] || null;
        }

        function generateModalContent(rfc) {
            const statusMap = {
                'NEW': { class: 'status-new', text: '–ù–æ–≤—ã–π' },
                'UNDER_REVIEW': { class: 'status-under-review', text: '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏' },
                'APPROVED': { class: 'status-approved', text: '–û–¥–æ–±—Ä–µ–Ω' },
                'IMPLEMENTED': { class: 'status-implemented', text: '–í–Ω–µ–¥—Ä–µ–Ω' },
                'REJECTED': { class: 'status-rejected', text: '–û—Ç–∫–ª–æ–Ω–µ–Ω' }
            };

            const urgencyMap = {
                'EMERGENCY': { class: 'urgency-emergency', text: '–ë–µ–∑–æ—Ç–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ' },
                'URGENT': { class: 'urgency-urgent', text: '–°—Ä–æ—á–Ω–æ–µ' },
                'PLANNED': { class: 'urgency-planned', text: '–ü–ª–∞–Ω–æ–≤–æ–µ' }
            };

            const confirmationMap = {
                'PENDING': { class: 'confirmation-pending', text: '–û–∂–∏–¥–∞–Ω–∏–µ' },
                'CONFIRMED': { class: 'confirmation-confirmed', text: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ' },
                'REJECTED': { class: 'confirmation-rejected', text: '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ' }
            };

            const executionMap = {
                'PENDING': { class: 'execution-pending', text: '–û–∂–∏–¥–∞–Ω–∏–µ' },
                'IN_PROGRESS': { class: 'execution-in-progress', text: '–í —Ä–∞–±–æ—Ç–µ' },
                'DONE': { class: 'execution-done', text: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' }
            };

            let html = `
                <div class="modal-section">
                    <div class="modal-section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                    <div class="modal-field">
                        <div class="modal-field-label">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
                        <div class="modal-field-value" style="font-weight: 600; font-size: 16px;">${rfc.title}</div>
                    </div>
                    ${rfc.description ? `
                    <div class="modal-field">
                        <div class="modal-field-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                        <div class="modal-description">${rfc.description}</div>
                    </div>
                    ` : ''}
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div class="modal-field">
                            <div class="modal-field-label">–°—Ç–∞—Ç—É—Å</div>
                            <div class="modal-field-value">
                                <span class="status-badge ${statusMap[rfc.status].class}">${statusMap[rfc.status].text}</span>
                            </div>
                        </div>
                        <div class="modal-field">
                            <div class="modal-field-label">–°—Ä–æ—á–Ω–æ—Å—Ç—å</div>
                            <div class="modal-field-value">
                                <span class="urgency-badge ${urgencyMap[rfc.urgency].class}">${urgencyMap[rfc.urgency].text}</span>
                            </div>
                        </div>
                        <div class="modal-field">
                            <div class="modal-field-label">–î–∞—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                            <div class="modal-field-value">${new Date(rfc.implementationDate).toLocaleString('ru-RU')}</div>
                        </div>
                        <div class="modal-field">
                            <div class="modal-field-label">–°–æ–∑–¥–∞—Ç–µ–ª—å</div>
                            <div class="modal-field-value">${rfc.requesterName}</div>
                        </div>
                        <div class="modal-field">
                            <div class="modal-field-label">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</div>
                            <div class="modal-field-value">${new Date(rfc.createDatetime).toLocaleString('ru-RU')}</div>
                        </div>
                        <div class="modal-field">
                            <div class="modal-field-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
                            <div class="modal-field-value">${new Date(rfc.updateDatetime).toLocaleString('ru-RU')}</div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <div class="modal-section-title">–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã</div>
                    ${rfc.affectedSystems.map(system => `
                        <div class="affected-system-card">
                            <div class="system-title">üñ•Ô∏è ${system.systemName}</div>
                            ${system.affectedSubsystems.map(subsystem => `
                                <div class="subsystem-card">
                                    <div class="subsystem-header">
                                        <div class="subsystem-name">üì¶ ${subsystem.subsystemName}</div>
                                    </div>
                                    <div class="subsystem-info">
                                        <div>
                                            <strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</strong> ${subsystem.executorName}
                                        </div>
                                        <div>
                                            <strong>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:</strong>
                                            <span class="confirmation-badge ${confirmationMap[subsystem.confirmationStatus].class}">
                                                ${confirmationMap[subsystem.confirmationStatus].text}
                                            </span>
                                        </div>
                                        <div>
                                            <strong>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:</strong>
                                            <span class="execution-badge ${executionMap[subsystem.executionStatus].class}">
                                                ${executionMap[subsystem.executionStatus].text}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>

                ${rfc.attachments && rfc.attachments.length > 0 ? `
                <div class="modal-section">
                    <div class="modal-section-title">–í–ª–æ–∂–µ–Ω–∏—è (${rfc.attachments.length})</div>
                    ${rfc.attachments.map(attachment => `
                        <div class="attachment-item">
                            <div class="attachment-icon">üìé</div>
                            <div class="attachment-details">
                                <div class="attachment-name">${attachment.originalFilename}</div>
                                <div class="attachment-meta">
                                    ${formatFileSize(attachment.fileSize)} ¬∑ 
                                    –ó–∞–≥—Ä—É–∑–∏–ª: ${attachment.uploadedByName} ¬∑ 
                                    ${new Date(attachment.createDatetime).toLocaleString('ru-RU')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;

            return html;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // ============= CREATE RFC MODAL FUNCTIONS =============

        // Global state for create RFC
        let systemsData = [];
        let teamsData = [];
        let systemCounter = 0;
        let subsystemCounter = 0;
        let useAutocomplete = false; // –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º –º–Ω–æ–≥–æ, –≤–∫–ª—é—á–∞–µ–º autocomplete
        let systemsCache = new Map(); // –ö–µ—à –¥–ª—è –ø–æ–¥—Å–∏—Å—Ç–µ–º: systemId -> subsystems[]

        // Open create RFC modal
        function openCreateRfcModal() {
            const modal = document.getElementById('createRfcModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Load reference data if not already loaded
            if (systemsData.length === 0 || teamsData.length === 0) {
                loadReferenceDataForRfcCreation();
            }
            
            // Reset form
            resetCreateRfcForm();
        }

        // Close create RFC modal
        function closeCreateRfcModal() {
            const modal = document.getElementById('createRfcModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            resetCreateRfcForm();
        }

        // Close modal on overlay click
        document.getElementById('createRfcModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateRfcModal();
            }
        });

        // Reset form
        function resetCreateRfcForm() {
            document.getElementById('rfc-form').reset();
            document.getElementById('affected-systems-list').innerHTML = '';
            document.querySelectorAll('.form-group.error').forEach(group => {
                group.classList.remove('error');
            });
            document.getElementById('systems-error').style.display = 'none';
            document.getElementById('title-counter').textContent = '0';
            document.getElementById('description-counter').textContent = '0';
            systemCounter = 0;
        }

        // Load reference data (systems, teams)
        async function loadReferenceDataForRfcCreation() {
            showLoading();
            
            try {
                // –£–ú–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê: –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–µ 200 —Å–∏—Å—Ç–µ–º
                // –ï—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ - –≤–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º autocomplete —Å –ø–æ–∏—Å–∫–æ–º
                // Note: –∏—Å–ø–æ–ª—å–∑—É–µ–º size=200 –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ (–æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç page size=20 –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
                // const systemsResponse = await fetch('/api/system?page=0&size=200', {
                //     headers: { 'Authorization': 'Bearer ' + getAuthToken() }
                // });
                // const systemsPageData = await systemsResponse.json();
                // systemsData = systemsPageData.content; // SystemResponse[]
                // 
                // // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–µ–Ω –ª–∏ autocomplete
                // if (systemsPageData.totalElements > 200) {
                //     useAutocomplete = true;
                //     console.log('–ú–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º, –≤–∫–ª—é—á–∞–µ–º autocomplete');
                // }
                
                // Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–∏–º–∏—Ç–∏—Ä—É–µ–º < 200 —Å–∏—Å—Ç–µ–º)
                const mockSystemsPageData = {
                    content: [
                        { id: 1, name: 'Auth System', description: '–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏' },
                        { id: 2, name: 'Payment System', description: '–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π' },
                        { id: 3, name: 'Notification System', description: '–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π' },
                        { id: 4, name: 'Analytics System', description: '–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏' },
                        { id: 5, name: 'Storage System', description: '–°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö' }
                    ],
                    totalElements: 5,
                    totalPages: 1,
                    size: 200,
                    number: 0
                };
                
                systemsData = mockSystemsPageData.content;
                useAutocomplete = mockSystemsPageData.totalElements > 200;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
                // const teamsResponse = await fetch('/api/team?page=0&size=200', {
                //     headers: { 'Authorization': 'Bearer ' + getAuthToken() }
                // });
                // const teamsPageData = await teamsResponse.json();
                // teamsData = teamsPageData.content;
                
                // Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–º–∞–Ω–¥
                teamsData = [
                    {
                        id: 1,
                        name: 'Auth Team',
                        description: '–ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏',
                        members: [
                            { id: 1, username: 'i.ivanov', firstName: '–ò–≤–∞–Ω', lastName: '–ò–≤–∞–Ω–æ–≤', role: 'EXECUTOR' },
                            { id: 2, username: 'p.petrov', firstName: '–ü–µ—Ç—Ä', lastName: '–ü–µ—Ç—Ä–æ–≤', role: 'EXECUTOR' }
                        ]
                    },
                    {
                        id: 2,
                        name: 'Payment Team',
                        description: '–ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã',
                        members: [
                            { id: 3, username: 's.sidorova', firstName: '–°–≤–µ—Ç–ª–∞–Ω–∞', lastName: '–°–∏–¥–æ—Ä–æ–≤–∞', role: 'EXECUTOR' },
                            { id: 4, username: 'k.kozlov', firstName: '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω', lastName: '–ö–æ–∑–ª–æ–≤', role: 'EXECUTOR' }
                        ]
                    },
                    {
                        id: 3,
                        name: 'Infrastructure Team',
                        description: '–ö–æ–º–∞–Ω–¥–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã',
                        members: [
                            { id: 5, username: 'm.morozova', firstName: '–ú–∞—Ä–∏—è', lastName: '–ú–æ—Ä–æ–∑–æ–≤–∞', role: 'EXECUTOR' },
                            { id: 6, username: 'n.novikov', firstName: '–ù–∏–∫–æ–ª–∞–π', lastName: '–ù–æ–≤–∏–∫–æ–≤', role: 'EXECUTOR' }
                        ]
                    }
                ];

                console.log('Reference data loaded:', { 
                    systems: systemsData.length, 
                    teams: teamsData.length,
                    useAutocomplete: useAutocomplete 
                });
                
            } catch (error) {
                console.error('Error loading reference data:', error);
                showToast('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
            } finally {
                hideLoading();
            }
        }

        // –ü–æ–∏—Å–∫ —Å–∏—Å—Ç–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–¥–ª—è autocomplete)
        async function searchSystems(query) {
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
                // const response = await fetch(`/api/system?name=${encodeURIComponent(query)}&page=0&size=20`, {
                //     headers: { 'Authorization': 'Bearer ' + getAuthToken() }
                // });
                // const data = await response.json();
                // return data.content;
                
                // Mock: —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                return systemsData.filter(s => 
                    s.name.toLowerCase().includes(query.toLowerCase())
                );
            } catch (error) {
                console.error('Error searching systems:', error);
                return [];
            }
        }

        // Setup character counters for RFC form
        document.getElementById('rfc-title').addEventListener('input', function() {
            document.getElementById('title-counter').textContent = this.value.length;
        });

        document.getElementById('rfc-description').addEventListener('input', function() {
            document.getElementById('description-counter').textContent = this.value.length;
        });

        // Add system card
        document.getElementById('add-system-btn').addEventListener('click', function() {
            addSystemCard();
        });

        function addSystemCard() {
            systemCounter++;
            const systemId = `system-${systemCounter}`;
            
            const systemCard = document.createElement('div');
            systemCard.className = 'affected-system-card';
            systemCard.id = systemId;
            systemCard.dataset.subsystemCounter = 0;

            // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –∫–æ–Ω—Ç—Ä–æ–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º
            let systemSelectHTML = '';
            
            if (useAutocomplete) {
                // –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º - autocomplete —Å –ø–æ–∏—Å–∫–æ–º
                systemSelectHTML = `
                    <div class="autocomplete-container">
                        <input 
                            type="text" 
                            class="autocomplete-input system-autocomplete" 
                            placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã..."
                            data-system-id="${systemId}"
                            autocomplete="off"
                        >
                        <input type="hidden" class="selected-system-id" data-system-id="${systemId}">
                        <div class="autocomplete-dropdown" id="${systemId}-dropdown">
                            <!-- Results will be added here -->
                        </div>
                    </div>
                `;
            } else {
                // –î–ª—è –º–∞–ª–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ - –æ–±—ã—á–Ω—ã–π select
                systemSelectHTML = `
                    <select class="system-select" data-system-id="${systemId}" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É</option>
                        ${systemsData.map(system => 
                            `<option value="${system.id}">${system.name}</option>`
                        ).join('')}
                    </select>
                `;
            }

            systemCard.innerHTML = `
                <button type="button" class="btn-remove-system" onclick="removeSystemCard('${systemId}')">
                    √ó –£–¥–∞–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
                </button>
                
                <div class="system-header">
                    <div class="system-select-group">
                        <label>–°–∏—Å—Ç–µ–º–∞ <span style="color: #e74c3c;">*</span></label>
                        ${systemSelectHTML}
                    </div>
                </div>

                <div class="subsystems-list" id="${systemId}-subsystems">
                    <!-- Subsystems will be added here -->
                </div>

                <button type="button" class="btn-add btn-add-subsystem" onclick="addSubsystemCard('${systemId}')">
                    + –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∏—Å—Ç–µ–º—É
                </button>
            `;

            document.getElementById('affected-systems-list').appendChild(systemCard);

            // Setup event listeners
            if (useAutocomplete) {
                setupAutocomplete(systemId);
            } else {
                const systemSelect = systemCard.querySelector('.system-select');
                systemSelect.addEventListener('change', function() {
                    handleSystemChange(systemId, this.value);
                });
            }
        }

        // Setup autocomplete –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
        function setupAutocomplete(systemId) {
            const input = document.querySelector(`input.system-autocomplete[data-system-id="${systemId}"]`);
            const dropdown = document.getElementById(`${systemId}-dropdown`);
            const hiddenInput = document.querySelector(`input.selected-system-id[data-system-id="${systemId}"]`);
            let searchTimeout;

            input.addEventListener('input', function() {
                const query = this.value.trim();
                
                // Debounce search
                clearTimeout(searchTimeout);
                
                if (query.length < 2) {
                    dropdown.classList.remove('show');
                    return;
                }
                
                searchTimeout = setTimeout(async () => {
                    dropdown.innerHTML = '<div class="autocomplete-loading">–ü–æ–∏—Å–∫...</div>';
                    dropdown.classList.add('show');
                    
                    const results = await searchSystems(query);
                    
                    if (results.length === 0) {
                        dropdown.innerHTML = '<div class="autocomplete-no-results">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    } else {
                        dropdown.innerHTML = results.map(system => 
                            `<div class="autocomplete-item" data-system-id="${system.id}" data-system-name="${system.name}">
                                <div style="font-weight: 500;">${system.name}</div>
                                ${system.description ? `<div style="font-size: 11px; color: #6c757d; margin-top: 2px;">${system.description}</div>` : ''}
                            </div>`
                        ).join('');
                        
                        // Add click handlers
                        dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                            item.addEventListener('click', function() {
                                const selectedId = this.dataset.systemId;
                                const selectedName = this.dataset.systemName;
                                
                                input.value = selectedName;
                                hiddenInput.value = selectedId;
                                dropdown.classList.remove('show');
                                
                                handleSystemChange(systemId, selectedId);
                            });
                        });
                    }
                }, 300);
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });
        }

        // Remove system card
        function removeSystemCard(systemId) {
            const card = document.getElementById(systemId);
            if (card) {
                card.remove();
            }
        }

        // Handle system selection change
        async function handleSystemChange(systemId, selectedSystemId) {
            const systemCard = document.getElementById(systemId);
            const subsystemsList = document.getElementById(`${systemId}-subsystems`);
            
            // Clear existing subsystems
            subsystemsList.innerHTML = '';
            systemCard.dataset.subsystemCounter = 0;
            
            // Store selected system ID
            systemCard.dataset.selectedSystemId = selectedSystemId;
            
            if (!selectedSystemId) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
            if (systemsCache.has(parseInt(selectedSystemId))) {
                const cachedSubsystems = systemsCache.get(parseInt(selectedSystemId));
                systemCard.dataset.subsystems = JSON.stringify(cachedSubsystems);
                console.log('–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫–µ—à–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã', selectedSystemId);
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
            try {
                subsystemsList.innerHTML = '<div style="padding: 10px; color: #6c757d; font-size: 12px;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥—Å–∏—Å—Ç–µ–º...</div>';
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
                // const response = await fetch(`/api/system/${selectedSystemId}/subsystem`, {
                //     headers: { 'Authorization': 'Bearer ' + getAuthToken() }
                // });
                // const subsystems = await response.json(); // Array of SubsystemResponse
                
                // Mock –¥–∞–Ω–Ω—ã–µ: –∏–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å —Å–µ—Ä–≤–µ—Ä–∞
                await new Promise(resolve => setTimeout(resolve, 300)); // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                
                const mockSubsystemsMap = {
                    1: [ // Auth System
                        { id: 1, name: 'Auth Service', systemId: 1, teamId: 1 },
                        { id: 2, name: 'User DB', systemId: 1, teamId: 1 }
                    ],
                    2: [ // Payment System
                        { id: 3, name: 'Payment Gateway', systemId: 2, teamId: 2 },
                        { id: 4, name: 'Transaction Service', systemId: 2, teamId: 2 },
                        { id: 5, name: 'Billing Service', systemId: 2, teamId: 3 }
                    ],
                    3: [ // Notification System
                        { id: 6, name: 'Email Service', systemId: 3, teamId: 3 },
                        { id: 7, name: 'SMS Service', systemId: 3, teamId: 3 }
                    ],
                    4: [ // Analytics System
                        { id: 8, name: 'Data Warehouse', systemId: 4, teamId: 3 },
                        { id: 9, name: 'Reporting Engine', systemId: 4, teamId: 1 }
                    ],
                    5: [ // Storage System
                        { id: 10, name: 'Object Storage', systemId: 5, teamId: 2 },
                        { id: 11, name: 'File Manager', systemId: 5, teamId: 2 }
                    ]
                };
                
                const subsystems = mockSubsystemsMap[selectedSystemId] || [];
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
                systemsCache.set(parseInt(selectedSystemId), subsystems);
                systemCard.dataset.subsystems = JSON.stringify(subsystems);
                
                // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
                subsystemsList.innerHTML = '';
                
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${subsystems.length} –ø–æ–¥—Å–∏—Å—Ç–µ–º –¥–ª—è —Å–∏—Å—Ç–µ–º—ã ${selectedSystemId}`);
                
            } catch (error) {
                console.error('Error loading subsystems:', error);
                subsystemsList.innerHTML = '';
                showToast('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã');
            }
        }

        // Add subsystem card
        function addSubsystemCard(systemId) {
            const systemCard = document.getElementById(systemId);
            const selectedSystemId = systemCard.dataset.selectedSystemId;
            
            if (!selectedSystemId) {
                showToast('error', '–û—à–∏–±–∫–∞', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É');
                return;
            }

            // Get subsystems from dataset (loaded by handleSystemChange)
            const subsystemsJson = systemCard.dataset.subsystems;
            if (!subsystemsJson) {
                showToast('error', '–û—à–∏–±–∫–∞', '–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã');
                return;
            }

            const subsystems = JSON.parse(subsystemsJson);
            if (subsystems.length === 0) {
                showToast('error', '–û—à–∏–±–∫–∞', '–£ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º');
                return;
            }

            let subsystemCounter = parseInt(systemCard.dataset.subsystemCounter || 0) + 1;
            systemCard.dataset.subsystemCounter = subsystemCounter;
            
            const subsystemId = `${systemId}-subsystem-${subsystemCounter}`;
            
            const subsystemCard = document.createElement('div');
            subsystemCard.className = 'subsystem-card';
            subsystemCard.id = subsystemId;

            subsystemCard.innerHTML = `
                <button type="button" class="btn-remove-subsystem" onclick="removeSubsystemCard('${subsystemId}')" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–¥—Å–∏—Å—Ç–µ–º—É">
                    √ó
                </button>
                
                <div class="subsystem-fields">
                    <div class="subsystem-field">
                        <label>–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ <span style="color: #e74c3c;">*</span></label>
                        <select class="subsystem-select" data-subsystem-id="${subsystemId}" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—É</option>
                            ${subsystems.map(subsystem => 
                                `<option value="${subsystem.id}" data-team-id="${subsystem.teamId}">${subsystem.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="subsystem-field">
                        <label>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å <span style="color: #e74c3c;">*</span></label>
                        <select class="executor-select" data-subsystem-id="${subsystemId}" required disabled>
                            <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—É</option>
                        </select>
                    </div>
                </div>
            `;

            document.getElementById(`${systemId}-subsystems`).appendChild(subsystemCard);

            // Add event listener for subsystem selection
            const subsystemSelect = subsystemCard.querySelector('.subsystem-select');
            subsystemSelect.addEventListener('change', function() {
                handleSubsystemChange(subsystemId, this.value, this.selectedOptions[0].dataset.teamId);
            });
        }

        // Remove subsystem card
        function removeSubsystemCard(subsystemId) {
            const card = document.getElementById(subsystemId);
            if (card) {
                card.remove();
            }
        }

        // Handle subsystem selection change
        function handleSubsystemChange(subsystemId, selectedSubsystemId, teamId) {
            const subsystemCard = document.getElementById(subsystemId);
            const executorSelect = subsystemCard.querySelector('.executor-select');
            
            if (!selectedSubsystemId || !teamId) {
                executorSelect.disabled = true;
                executorSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—É</option>';
                return;
            }

            const team = teamsData.find(t => t.id == teamId);
            
            if (!team || !team.members || team.members.length === 0) {
                executorSelect.disabled = true;
                executorSelect.innerHTML = '<option value="">–£ –∫–æ–º–∞–Ω–¥—ã –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</option>';
                showToast('error', '–û—à–∏–±–∫–∞', '–£ –∫–æ–º–∞–Ω–¥—ã –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤');
                return;
            }

            // Populate executor dropdown with team members
            executorSelect.disabled = false;
            executorSelect.innerHTML = `
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                ${team.members.map(member => 
                    `<option value="${member.id}">${member.lastName} ${member.firstName}</option>`
                ).join('')}
            `;
        }

        // Form validation
        function validateRfcForm() {
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('.form-group.error').forEach(group => {
                group.classList.remove('error');
            });
            document.getElementById('systems-error').style.display = 'none';

            // Validate title
            const title = document.getElementById('rfc-title');
            if (!title.value.trim()) {
                title.closest('.form-group').classList.add('error');
                isValid = false;
            }

            // Validate implementation date
            const implementationDate = document.getElementById('rfc-implementationDate');
            if (!implementationDate.value) {
                implementationDate.closest('.form-group').classList.add('error');
                isValid = false;
            }

            // Validate urgency
            const urgency = document.getElementById('rfc-urgency');
            if (!urgency.value) {
                urgency.closest('.form-group').classList.add('error');
                isValid = false;
            }

            // Validate affected systems
            const systemCards = document.querySelectorAll('.affected-system-card');
            if (systemCards.length === 0) {
                document.getElementById('systems-error').style.display = 'block';
                isValid = false;
            } else {
                // Check each system has at least one subsystem
                systemCards.forEach(systemCard => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ —Å–∏—Å—Ç–µ–º–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è select, –∏ –¥–ª—è autocomplete)
                    let systemValue = null;
                    
                    if (useAutocomplete) {
                        const hiddenInput = systemCard.querySelector('.selected-system-id');
                        systemValue = hiddenInput ? hiddenInput.value : null;
                    } else {
                        const systemSelect = systemCard.querySelector('.system-select');
                        systemValue = systemSelect ? systemSelect.value : null;
                    }
                    
                    if (!systemValue) {
                        isValid = false;
                        document.getElementById('systems-error').style.display = 'block';
                    }
                    
                    const subsystemCards = systemCard.querySelectorAll('.subsystem-card');
                    if (subsystemCards.length === 0) {
                        isValid = false;
                        document.getElementById('systems-error').style.display = 'block';
                    }

                    // Validate each subsystem has executor
                    subsystemCards.forEach(subsystemCard => {
                        const subsystemSelect = subsystemCard.querySelector('.subsystem-select');
                        const executorSelect = subsystemCard.querySelector('.executor-select');
                        
                        if (!subsystemSelect.value || !executorSelect.value) {
                            isValid = false;
                            document.getElementById('systems-error').style.display = 'block';
                        }
                    });
                });
            }

            return isValid;
        }

        // Build RFC request payload according to OpenAPI spec
        function buildRfcRequest() {
            const formData = {
                title: document.getElementById('rfc-title').value.trim(),
                description: document.getElementById('rfc-description').value.trim() || null,
                implementationDate: new Date(document.getElementById('rfc-implementationDate').value).toISOString(),
                urgency: document.getElementById('rfc-urgency').value,
                affectedSystems: []
            };

            // Build affected systems array
            const systemCards = document.querySelectorAll('.affected-system-card');
            systemCards.forEach(systemCard => {
                // –ü–æ–ª—É—á–∞–µ–º ID —Å–∏—Å—Ç–µ–º—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è select, –∏ –¥–ª—è autocomplete)
                let systemIdValue;
                if (useAutocomplete) {
                    const hiddenInput = systemCard.querySelector('.selected-system-id');
                    systemIdValue = hiddenInput.value;
                } else {
                    systemIdValue = systemCard.querySelector('.system-select').value;
                }
                
                const systemId = parseInt(systemIdValue);
                const subsystemCards = systemCard.querySelectorAll('.subsystem-card');
                
                const affectedSubsystems = [];
                subsystemCards.forEach(subsystemCard => {
                    const subsystemId = parseInt(subsystemCard.querySelector('.subsystem-select').value);
                    const executorId = parseInt(subsystemCard.querySelector('.executor-select').value);
                    
                    affectedSubsystems.push({
                        subsystemId: subsystemId,
                        executorId: executorId
                    });
                });

                formData.affectedSystems.push({
                    systemId: systemId,
                    affectedSubsystems: affectedSubsystems
                });
            });

            return formData;
        }

        // Handle form submission
        document.getElementById('rfc-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Validate form
            if (!validateRfcForm()) {
                showToast('error', '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π');
                return;
            }

            // Build request payload
            const rfcRequest = buildRfcRequest();
            console.log('RFC Request:', rfcRequest);

            // Submit to API
            showLoading();
            
            try {
                // In real app:
                // const response = await fetch('/api/rfc', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //         'Authorization': 'Bearer ' + getAuthToken()
                //     },
                //     body: JSON.stringify(rfcRequest)
                // });
                // 
                // if (response.status === 201) {
                //     const rfcResponse = await response.json();
                //     console.log('RFC Created:', rfcResponse);
                //     closeCreateRfcModal();
                //     showToast('success', '–£—Å–ø–µ—à–Ω–æ', `RFC-${String(rfcResponse.id).padStart(3, '0')} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω`);
                //     // Reload RFC list
                //     location.reload();
                // } else {
                //     const errorResponse = await response.json();
                //     showToast('error', '–û—à–∏–±–∫–∞', errorResponse.errors[0].message);
                // }

                // Mock success response
                setTimeout(() => {
                    hideLoading();
                    closeCreateRfcModal();
                    showToast('success', '–£—Å–ø–µ—à–Ω–æ', 'RFC-007 —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω');
                    
                    // In real app, reload the list or add the new RFC to the table
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }, 1000);

            } catch (error) {
                hideLoading();
                console.error('Error creating RFC:', error);
                showToast('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å RFC. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        });

        // ============= EDIT RFC MODAL - INITIALIZATION =============
        
        // Add event listener for "Add System" button in edit modal
        document.getElementById('edit-add-system-btn').addEventListener('click', function() {
            addEditSystemCard();
        });

        // Add character counters for edit form
        document.getElementById('edit-rfc-title').addEventListener('input', function() {
            document.getElementById('edit-title-counter').textContent = this.value.length;
        });

        document.getElementById('edit-rfc-description').addEventListener('input', function() {
            document.getElementById('edit-description-counter').textContent = this.value.length;
        });

        // Close modal on overlay click
        document.getElementById('editRfcModal').addEventListener('click', function(e) {
            if (e.target.id === 'editRfcModal') {
                closeEditRfcModal();
            }
        });

        // Handle edit RFC form submission - reuses create RFC logic for building request
        document.getElementById('edit-rfc-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            // Validate using create RFC validation logic adapted for edit form
            const form = document.getElementById('edit-rfc-form');
            const systemCards = document.querySelectorAll('#edit-affected-systems-list .system-card');

            // Check basic validation
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Check at least one system
            if (systemCards.length === 0) {
                showToast('error', '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Å–∏—Å—Ç–µ–º—É');
                return;
            }

            // Check each system has subsystems
            for (const systemCard of systemCards) {
                const subsystemCards = systemCard.querySelectorAll('.subsystem-card');
                if (subsystemCards.length === 0) {
                    showToast('error', '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ö–∞–∂–¥–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É –ø–æ–¥—Å–∏—Å—Ç–µ–º—É');
                    return;
                }

                // Check each subsystem has executor selected
                for (const subsystemCard of subsystemCards) {
                    const executorSelect = subsystemCard.querySelector('.executor-select');
                    if (!executorSelect.value) {
                        showToast('error', '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã');
                        return;
                    }
                }
            }

            const rfcId = document.getElementById('edit-rfc-id').value;
            
            // Build request using same logic as create RFC - matching RfcRequest schema
            const title = document.getElementById('edit-rfc-title').value;
            const description = document.getElementById('edit-rfc-description').value;
            const implementationDate = document.getElementById('edit-rfc-implementationDate').value;
            const urgency = document.getElementById('edit-rfc-urgency').value;

            // Build affected systems array
            const affectedSystems = [];
            systemCards.forEach(systemCard => {
                const systemSelect = systemCard.querySelector('.system-select');
                const systemId = parseInt(systemSelect.value);

                const affectedSubsystems = [];
                const subsystemCards = systemCard.querySelectorAll('.subsystem-card');

                subsystemCards.forEach(subsystemCard => {
                    const subsystemSelect = subsystemCard.querySelector('.subsystem-select');
                    const executorSelect = subsystemCard.querySelector('.executor-select');

                    affectedSubsystems.push({
                        subsystemId: parseInt(subsystemSelect.value),
                        executorId: parseInt(executorSelect.value)
                    });
                });

                affectedSystems.push({
                    systemId: systemId,
                    affectedSubsystems: affectedSubsystems
                });
            });

            // Build request matching OpenAPI RfcRequest schema (same as POST /rfc)
            const requestBody = {
                title: title,
                description: description || null,
                implementationDate: new Date(implementationDate).toISOString(),
                urgency: urgency,
                affectedSystems: affectedSystems
            };

            console.log('Updating RFC:', rfcId, requestBody);

            showLoading();

            try {
                // In real app, make PUT request to /rfc/{id}
                // const response = await fetch(`/rfc/${rfcId}`, {
                //     method: 'PUT',
                //     headers: {
                //         'Content-Type': 'application/json',
                //         'Authorization': `Bearer ${authToken}`
                //     },
                //     body: JSON.stringify(requestBody)
                // });

                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Simulate success response
                const response = { ok: true };

                hideLoading();

                if (response.ok) {
                    // const updatedRfc = await response.json();
                    showToast('success', '–£—Å–ø–µ—Ö', `RFC-${String(rfcId).padStart(3, '0')} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω`);
                    
                    // Close modal after short delay
                    setTimeout(() => {
                        closeEditRfcModal();
                        // In real app, refresh the RFC list
                        // location.reload();
                    }, 1500);
                } else {
                    // const errorData = await response.json();
                    showToast('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å RFC. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                }
            } catch (error) {
                hideLoading();
                console.error('Error updating RFC:', error);
                showToast('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å RFC. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        });
    </script>
</body>
</html>

